From 3a944c520c0d55d7dcb7a5dfba917eb916005801 Mon Sep 17 00:00:00 2001
From: Richard Hughes <richard@hughsie.com>
Date: Wed, 8 Jan 2014 17:46:51 +0000
Subject: [PATCH 04/11] Load the colorhug-spectro-utils data file from a
 GResource

---
 src/Makefile.am                    | 14 ++++++++++++--
 src/ch-spectro-util.c              |  6 +++---
 src/colorhug-spectro.gresource.xml |  6 ++++++
 3 files changed, 21 insertions(+), 5 deletions(-)
 create mode 100644 src/colorhug-spectro.gresource.xml

diff --git a/src/Makefile.am b/src/Makefile.am
index e04a4fd..db780d7 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -22,6 +22,8 @@ colorhug_spectro_util_SOURCES =				\
 	ch-graph-widget.h				\
 	ch-point-obj.c					\
 	ch-point-obj.h					\
+	ch-spectro-resources.c				\
+	ch-spectro-resources.h				\
 	ch-spectro-util.c
 
 colorhug_spectro_util_LDADD =				\
@@ -140,15 +142,23 @@ ch-ccmx-resources.c: colorhug-ccmx.gresource.xml ../data/ch-ccmx.ui
 ch-ccmx-resources.h: colorhug-ccmx.gresource.xml
 	glib-compile-resources --target=$@ --sourcedir=$(top_srcdir)/data --generate-header --c-name ch $(srcdir)/colorhug-ccmx.gresource.xml
 
+ch-spectro-resources.c: colorhug-spectro.gresource.xml ../data/ch-spectro-util.ui
+	glib-compile-resources --target=$@ --sourcedir=$(top_srcdir)/data --generate-source --c-name ch $(srcdir)/colorhug-spectro.gresource.xml
+ch-spectro-resources.h: colorhug-spectro.gresource.xml
+	glib-compile-resources --target=$@ --sourcedir=$(top_srcdir)/data --generate-header --c-name ch $(srcdir)/colorhug-spectro.gresource.xml
+
 BUILT_SOURCES =						\
 	ch-ccmx-resources.c				\
 	ch-ccmx-resources.h				\
 	ch-flash-resources.c				\
-	ch-flash-resources.h
+	ch-flash-resources.h				\
+	ch-spectro-resources.c				\
+	ch-spectro-resources.h
 
 EXTRA_DIST =						\
 	colorhug-ccmx.gresource.xml			\
-	colorhug-flash.gresource.xml
+	colorhug-flash.gresource.xml			\
+	colorhug-spectro.gresource.xml
 
 MAINTAINERCLEANFILES =					\
 	$(srcdir)/libchshared.a
diff --git a/src/ch-spectro-util.c b/src/ch-spectro-util.c
index 8dab826..5a559d6 100644
--- a/src/ch-spectro-util.c
+++ b/src/ch-spectro-util.c
@@ -393,9 +393,9 @@ ch_util_startup_cb (GApplication *application, ChCcmxPrivate *priv)
 
 	/* get UI */
 	priv->builder = gtk_builder_new ();
-	retval = gtk_builder_add_from_file (priv->builder,
-					    CH_DATA "/ch-spectro-util.ui",
-					    &error);
+	retval = gtk_builder_add_from_resource (priv->builder,
+						"/com/hughski/colorhug/ch-spectro-util.ui",
+						&error);
 	if (retval == 0) {
 		g_warning ("failed to load ui: %s",
 			   error->message);
diff --git a/src/colorhug-spectro.gresource.xml b/src/colorhug-spectro.gresource.xml
new file mode 100644
index 0000000..7059857
--- /dev/null
+++ b/src/colorhug-spectro.gresource.xml
@@ -0,0 +1,6 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<gresources>
+ <gresource prefix="/com/hughski/colorhug">
+ <file compressed="true">ch-spectro-util.ui</file>
+ </gresource>
+</gresources>
-- 
1.8.4.5

